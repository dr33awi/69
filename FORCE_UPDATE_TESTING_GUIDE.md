# ๐ ุฏููู ุงุฎุชุจุงุฑ ููุฒุฉ ุงูุชุญุฏูุซ ุงูุฅุฌุจุงุฑู (Force Update)

## โ ุงูุชุนุฏููุงุช ุงูููุทุจููุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุฅุถุงูุฉ `AppStatusMonitor` ุฅูู ุงูุชุทุจูู ูู `lib/main.dart`:

```dart
builder: (context, child) {
  return AppStatusMonitor(
    configManager: _configManager,
    child: PermissionCheckWidget(
      // ... ุจุงูู ุงูููุฏ
    ),
  );
}
```

---

## ๐ ุงููุชุทูุจุงุช

### ูู Firebase Remote Config

ูุฌุจ ุฃู ูููู ูุฏูู ูุฐู ุงููุนุงููุงุช:

| ุงููุนุงูู (Key) | ุงูููุน | ุงููููุฉ ููุงุฎุชุจุงุฑ |
|--------------|-------|-----------------|
| `force_update` | Boolean | `true` |
| `app_version` | String | `2.0.0` (ุฃู ุฃู ูุณุฎุฉ ุฃุนูู ูู ูุณุฎุฉ ุงูุชุทุจูู ุงูุญุงููุฉ) |
| `update_url_android` | String | ุฑุงุจุท ุชุทุจููู ูู Google Play |
| `update_features_list` | JSON | ูุงุฆูุฉ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ |

---

## ๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### 1๏ธโฃ **ุชุญุฏูุซ Firebase Remote Config**

#### ูู Firebase Console:
1. ุงุฐูุจ ุฅูู **Remote Config**
2. ุฃุถู/ุญุฏูุซ ุงููุนุงููุงุช ุงูุชุงููุฉ:

```
force_update = true (Boolean)
app_version = 2.0.0 (String)
update_url_android = https://play.google.com/store/apps/details?id=com.dhakarani1.app
```

#### ูุซุงู ุนูู `update_features_list` (JSON String):
```json
["ุชุญุณููุงุช ูุจูุฑุฉ ูู ุงูุฃุฏุงุก", "ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ", "ุฅุตูุงุญ ุงูุฃุฎุทุงุก ุงูุญุฑุฌุฉ", "ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู"]
```

3. ุงุถุบุท **Publish changes** (ูุดุฑ ุงูุชุบููุฑุงุช)

---

### 2๏ธโฃ **ุงุฎุชุจุงุฑ ุงูุชุทุจูู**

#### ุงูุทุฑููุฉ ุงูุฃููู - ุงุฎุชุจุงุฑ ูุจุงุดุฑ:

```dart
// ูู main.dart ุฃู ุฃู ููุงู ููุงุฎุชุจุงุฑ
Future<void> testForceUpdate() async {
  final remoteConfig = getIt<FirebaseRemoteConfigService>();
  
  // ูุฑุถ ุชุญุฏูุซ
  await remoteConfig.refresh();
  
  print('Force Update: ${remoteConfig.isForceUpdateRequired}');
  print('Required Version: ${remoteConfig.requiredAppVersion}');
}
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ - ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู:

1. ุฃุบูู ุงูุชุทุจูู ุชูุงูุงู
2. ุงูุชุธุฑ 10-30 ุซุงููุฉ
3. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู
4. ูุฌุจ ุฃู ุชุธูุฑ ุดุงุดุฉ ุงูุชุญุฏูุซ ุงูุฅุฌุจุงุฑู

---

### 3๏ธโฃ **ุงูุชุญูู ูู ุงูู Logs**

ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู ูู ุงูู Console:

```
โ Firebase Services initialized
โ [2/2] Advanced Firebase services initialized
โ Config Manager ready
๐ฅ Force Update Required: true
๐ฑ Current Version: 1.0.0
๐ฑ Required Version: 2.0.0
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุดุงุดุฉ ูุง ุชุธูุฑ

#### ุงูุณุจุจ ุงููุญุชูู 1: ุงูููู ูู ุชูุญุฏูุซ
**ุงูุญู:**
```dart
// ูู Debug Modeุ Remote Config ููุญุฏูุซ ููุฑุงู
// ูู Release Modeุ ูุฏ ูุณุชุบุฑู ุฏูุงุฆู ุญุณุจ ุงูุฅุนุฏุงุฏุงุช

// ููุฑุถ ุงูุชุญุฏูุซ ุงูููุฑู:
await _remoteConfig.setConfigSettings(RemoteConfigSettings(
  fetchTimeout: const Duration(seconds: 10),
  minimumFetchInterval: Duration.zero, // โ ุชุญุฏูุซ ููุฑู
));
```

#### ุงูุณุจุจ ุงููุญุชูู 2: ุงููุณุฎุฉ ุงููุทููุจุฉ ุฃูู ูู ุฃู ุชุณุงูู ุงูุญุงููุฉ
**ุงูุญู:**
ุชุฃูุฏ ูู ุฃู `app_version` ูู Firebase ุฃูุจุฑ ูู ูุณุฎุฉ ุงูุชุทุจูู ูู `pubspec.yaml`:

```yaml
# pubspec.yaml
version: 1.0.0+1  # ุงููุณุฎุฉ ุงูุญุงููุฉ

# Firebase Remote Config
app_version: 2.0.0  # โ ูุฌุจ ุฃู ุชููู ุฃูุจุฑ
```

#### ุงูุณุจุจ ุงููุญุชูู 3: ุงููุณุชุฎุฏู ุฃูุฑู ุจุงูุชุญุฏูุซ ุณุงุจูุงู
**ุงูุญู:**
```dart
// ูุณุญ ุงูุชุฎุฒูู ุงููุญูู ููุณูุงุญ ุจุฅุนุงุฏุฉ ุงูุธููุฑ
final storage = getIt<StorageService>();
await storage.remove('update_acknowledged_version');
```

---

## ๐ฏ ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูู 1: ุงูุชุญุฏูุซ ุงูุฅุฌุจุงุฑู ุงูุนุงุฏู
```
force_update = true
app_version = 2.0.0
ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชุธูุฑ ุดุงุดุฉ ForceUpdateScreen
```

### ุณููุงุฑูู 2: ูุถุน ุงูุตูุงูุฉ ูู ุงูุฃููููุฉ
```
force_update = true
maintenance_mode = true
ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชุธูุฑ MaintenanceScreen (ููุง ุงูุฃููููุฉ)
```

### ุณููุงุฑูู 3: ุงููุณุฎุฉ ูุญุฏูุซุฉ
```
force_update = true
app_version = 1.0.0 (ููุณ ูุณุฎุฉ ุงูุชุทุจูู)
ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุง ุดูุก ูุธูุฑ (ุงูุชุทุจูู ูุญุฏูุซ)
```

### ุณููุงุฑูู 4: Force Update ูุนุทูู
```
force_update = false
app_version = 2.0.0
ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุง ุดูุก ูุธูุฑ (ุงูููุฒุฉ ูุนุทููุฉ)
```

---

## ๐๏ธ ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ ุงูุณุฑูุน

### ูู Firebase Console:
1. ุงุณุชุฎุฏู **"In-app default values"** ููุงุฎุชุจุงุฑ ุงูุณุฑูุน
2. ุงุณุชุฎุฏู **"Conditions"** ูุงุณุชูุฏุงู ูุณุชุฎุฏููู ูุญุฏุฏูู
3. ุงุณุชุฎุฏู **"Percentage rollout"** ูููุดุฑ ุงูุชุฏุฑูุฌู

### ูู Android Studio / VS Code:
```dart
// ุฅุถุงูุฉ ุฒุฑ ุงุฎุชุจุงุฑ ูุคูุช ูู ุงูุฅุนุฏุงุฏุงุช
ElevatedButton(
  onPressed: () async {
    final config = getIt<RemoteConfigManager>();
    await config.refreshConfig();
    
    if (config.isForceUpdateRequired) {
      showDialog(
        context: context,
        builder: (context) => ForceUpdateScreen(),
      );
    }
  },
  child: Text('ุงุฎุชุจุงุฑ Force Update'),
)
```

---

## ๐ ูุนูููุงุช ุชูููุฉ

### ููู ูุนูู ุงููุธุงูุ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  1. App Start                           โ
โ     โ                                   โ
โ  2. Firebase Remote Config Initialize   โ
โ     โ                                   โ
โ  3. RemoteConfigManager Initialize      โ
โ     โ                                   โ
โ  4. Check force_update = true?          โ
โ     โ (Yes)                            โ
โ  5. Compare Versions                    โ
โ     โ (Outdated)                       โ
โ  6. Check acknowledged?                 โ
โ     โ (No)                             โ
โ  7. AppStatusMonitor Shows Screen       โ
โ     โ                                   โ
โ  8. ForceUpdateScreen Displayed         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ููุงุฑูุฉ ุงููุณุฎ (SemVer):
```dart
// 1.0.0 < 1.0.1 < 1.1.0 < 2.0.0

_compareVersions("1.0.0", "2.0.0") โ -1 (ูุญุชุงุฌ ุชุญุฏูุซ)
_compareVersions("2.0.0", "2.0.0") โ 0  (ูุญุฏูุซ)
_compareVersions("2.1.0", "2.0.0") โ 1  (ุฃุญุฏุซ ูู ุงููุทููุจ)
```

---

## โ Checklist ููุชุฃูุฏ ูู ุนูู ุงูููุฒุฉ

- [ ] `AppStatusMonitor` ูุถุงู ูู `main.dart`
- [ ] `force_update = true` ูู Firebase Remote Config
- [ ] `app_version` ุฃูุจุฑ ูู ูุณุฎุฉ ุงูุชุทุจูู ุงูุญุงููุฉ
- [ ] `update_url_android` ูุญุชูู ุนูู ุฑุงุจุท ุตุญูุญ
- [ ] ุชู ูุดุฑ ุงูุชุบููุฑุงุช ูู Firebase Console
- [ ] ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู ููุงุฎุชุจุงุฑ
- [ ] ุงูู Logs ุชุธูุฑ "Force Update Required: true"

---

## ๐ ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:
1. ุชุญูู ูู ุงูู Logs ูู Console
2. ุชุฃูุฏ ูู ุฃู Firebase ููููุฃ ุจุดูู ุตุญูุญ
3. ุฌุฑูุจ ูุณุญ ุงูู Cache: `flutter clean && flutter pub get`
4. ุชุญูู ูู ุฃู `google-services.json` ูุญุฏูุซ

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุนูุฏ ุชูุนูู ุงูููุฒุฉ ุจุดูู ุตุญูุญุ ุณูุฑู ุงููุณุชุฎุฏู:
- ุดุงุดุฉ ุฒุฑูุงุก ุฌูููุฉ ูุน ุฃููููุฉ ุชุญุฏูุซ
- ููุงุฑูุฉ ุจูู ุงููุณุฎุฉ ุงูุญุงููุฉ ูุงููุทููุจุฉ
- ูุงุฆูุฉ ุจููุฒุงุช ุงูุชุญุฏูุซ ุงูุฌุฏูุฏ
- ุฒุฑ "ุชุญุฏูุซ ุงูุชุทุจูู ุงูุขู" ููุชุญ ุงููุชุฌุฑ
- ุฒุฑ "ุฅุบูุงู ุงูุชุทุจูู" ูุฎูุงุฑ ุจุฏูู
- ูุง ูููู ุงูุฑุฌูุน ููุฎูู (PopScope: canPop: false)

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุฏููู ูู:** 28 ุฃูุชูุจุฑ 2025
**ุขุฎุฑ ุชุญุฏูุซ:** 28 ุฃูุชูุจุฑ 2025
